<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.aisolution.common.mapper.MailMapper">
    <select id="getMaxNotificationSeq" parameterType="HashMap" resultType="int">
    <![CDATA[
        select IFNULL(MAX(notification_seq), -1)+1 as maxSeq
          from tb_mail_notification
         where 1=1
    ]]>
    </select>
    
    <insert id="insertMailNotification" parameterType="HashMap">
    <![CDATA[
        insert into tb_mail_notification (
               notification_seq  , notification_type  , sender     , recipients
             , carbon_copy       , title              , contents   , send_yn
             , created_date, updated_date
        ) values (
               #{notificationSeq}, #{notificationType}, #{sender}  , #{recipients}
             , #{carbonCopy}     , #{title}           , #{contents}, #{sendYn}
             , CURRENT_TIMESTAMP(), CURRENT_TIMESTAMP()
        )
    ]]>
    </insert>
    
    <update id="updateMailNotification" parameterType="HashMap">
    <![CDATA[
        update tb_mail_notification
           set send_yn = 'Y'
             , send_date = CURRENT_TIMESTAMP()
             , update_date = CURRENT_TIMESTAMP()
         where 1=1
           and notification_seq = #{notification_seq}
    ]]>
    </update>
    
    <select id="getMailNotificationToday" parameterType="HashMap" resultType="HashMap">
    <![CDATA[
        select notification_seq as notificationSeq
             , notification_type as notificationType
             , sender
             , recipients
             , carbon_copy as cc
             , title
             , contents
          from tb_mail_notification
         where 1=1
           and notification_type = #{notificationType}
           and send_yn = 'N'
           and DATE_FORMAT(created_date, '%Y-%m-%d') = CURDATE()
         order by notification_seq asc
    ]]>
    </select>
    
    <select id="getMailNotificationPast" parameterType="HashMap" resultType="HashMap">
    <![CDATA[
        select notification_seq as notificationSeq
             , notification_type as notificationType
             , sender
             , recipients
             , carbon_copy as cc
             , title
             , contents
          from tb_mail_notification
         where 1=1
           and notification_type = #{notificationType}
           and send_yn = 'N'
           and DATE_FORMAT(created_date, '%Y-%m-%d') < CURDATE()
         order by notification_seq asc
    ]]>
    </select>
</mapper>