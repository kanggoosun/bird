<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.aisolution.koamtacon.mapper.service.BoardMapper">
    <select id="getNoticeListForUserCount" parameterType="HashMap" resultType="int">
    <![CDATA[
        select count(0) as cnt
          from tb_board
         where 1=1
           and board_type = '00'
           and CURRENT_TIMESTAMP() between posting_start_date and posting_end_date
    ]]>
    </select>
    
    <select id="getNoticeListForUser" parameterType="HashMap" resultType="HashMap">
    <![CDATA[
        select board_seq as boardSeq
             , title
             , contents
          from tb_board
         where 1=1
           and board_type = '00'
           and CURRENT_TIMESTAMP() between posting_start_date and posting_end_date
         order by IFNULL(updated_date, created_date) desc
         limit #{itemNoPerPage} offset #{offset}
    ]]>
    </select>
    
    <select id="getNoticeDetailForUser" parameterType="HashMap" resultType="HashMap">
    <![CDATA[
        select board_seq as boardSeq
             , title
             , contents
          from tb_board
         where 1=1
           and board_seq = #{boardSeq}
    ]]>
    </select>
    
    <select id="getFaqListForUserCount" parameterType="HashMap" resultType="int">
    <![CDATA[
        select count(0) as cnt
          from (select q.parent_seq as qParentSeq
                     , q.board_seq as qBoardSeq
                     , q.board_type as qBoardType
                     , q.writer_id as qWriterId
                     , q.class_seq as qClassSeq
                     , q.title as qBoardTitle
                     , q.contents as qBoardContents
                     , DATE_FORMAT(q.created_date, '%Y-%m-%d %H:%i:%s') as qWrittenDate
                     , DATE_FORMAT(q.updated_date, '%Y-%m-%d %H:%i:%s') as qLastEditedDate
                     , a.parent_seq as aParentSeq
                     , a.board_seq as aBoardSeq
                     , a.board_type as aBoardType
                     , a.writer_id as aWriterId
                     , a.class_seq as aClassSeq
                     , a.title as aBoardTitle
                     , a.contents as aBoardContents
                     , DATE_FORMAT(a.created_date, '%Y-%m-%d %H:%i:%s') as aWrittenDate
                     , DATE_FORMAT(a.updated_date, '%Y-%m-%d %H:%i:%s') as aLastEditedDate
                  from tb_board q
                       left join tb_user usr on usr.user_id = q.writer_id
                       left outer join tb_board a on a.parent_seq = q.board_seq
                 where 1=1
                   and q.board_type = #{boardType}
                   and q.parent_seq is null
               ) faq
         where 1=1
    ]]>
    <if test="searchParam != null and searchParam != ''">
    <![CDATA[
          and (faq.qBoardContents like CONCAT('%', #{searchParam}, '%') or faq.aBoardContents like CONCAT('%', #{searchParam}, '%'))
    ]]>
    </if>
    </select>
    
    <select id="getFaqListForUser" parameterType="HashMap" resultType="HashMap">
    <![CDATA[
        select faq.qParentSeq
             , faq.qBoardSeq
             , faq.qBoardType
             , faq.qWriterId
             , faq.qClassSeq
             , faq.qBoardTitle
             , faq.qBoardContents
             , faq.qWrittenDate
             , faq.qLastEditedDate
             , faq.aParentSeq
             , faq.aBoardSeq
             , faq.aBoardType
             , faq.aWriterId
             , faq.aClassSeq
             , faq.aBoardTitle
             , faq.aBoardContents
             , faq.aWrittenDate
             , faq.aLastEditedDate
          from (select q.parent_seq as qParentSeq
                     , q.board_seq as qBoardSeq
                     , q.board_type as qBoardType
                     , q.writer_id as qWriterId
                     , q.class_seq as qClassSeq
                     , q.title as qBoardTitle
                     , q.contents as qBoardContents
                     , DATE_FORMAT(q.created_date, '%Y-%m-%d %H:%i:%s') as qWrittenDate
                     , DATE_FORMAT(q.updated_date, '%Y-%m-%d %H:%i:%s') as qLastEditedDate
                     , a.parent_seq as aParentSeq
                     , a.board_seq as aBoardSeq
                     , a.board_type as aBoardType
                     , a.writer_id as aWriterId
                     , a.class_seq as aClassSeq
                     , a.title as aBoardTitle
                     , a.contents as aBoardContents
                     , DATE_FORMAT(a.created_date, '%Y-%m-%d %H:%i:%s') as aWrittenDate
                     , DATE_FORMAT(a.updated_date, '%Y-%m-%d %H:%i:%s') as aLastEditedDate
                  from tb_board q
                       left join tb_user usr on usr.user_id = q.writer_id
                       left outer join tb_board a on a.parent_seq = q.board_seq
                 where 1=1
                   and q.board_type = #{boardType}
                   and q.parent_seq is null
               ) faq
         where 1=1
    ]]>
    <if test="searchParam != null and searchParam != ''">
    <![CDATA[
          and (faq.qBoardContents like CONCAT('%', #{searchParam}, '%') or faq.aBoardContents like CONCAT('%', #{searchParam}, '%'))
    ]]>
    </if>
    <![CDATA[
         order by faq.qBoardContents asc
         limit #{itemNoPerPage} offset #{offset}
    ]]>
    </select>
</mapper>